import{a as H}from"./with-props-18HQcUlf.js";import{v as O,r as i,t as C,l as e,o as k}from"./chunk-GNGMS2XR-Mr3CDDLu.js";import{M as B}from"./MapboxRoute-RjSmR17c.js";import{g as J}from"./utils-D27r_kA2.js";const U="pk.eyJ1IjoidGxvdGxpc28xOTkxIiwiYSI6ImNtOGhvNmczbzAzemIyanF5aGJ4MzcycTMifQ.srM8EiwddIzpHRGpvGTo5g",ee=H(function(){const{id:j}=O(),[s,$]=i.useState(null),[M,p]=i.useState(!0);C();const[N,_]=i.useState(null),[b,D]=i.useState(null),[y,L]=i.useState(null),[Q,h]=i.useState(!1),[l,P]=i.useState(null),[d,z]=i.useState(null),[V,G]=i.useState(null),[W,I]=i.useState(null),F=async()=>{var r,o,n,c,m,x,t,w,S,E,R,T;p(!0);try{const u=await fetch(J()+`/api/trips/${j}`);if(!u.ok)throw new Error(`HTTP error! Status: ${u.status}`);const a=await u.json();A([((r=a.current_coordinates)==null?void 0:r.lng)||0,((o=a.current_coordinates)==null?void 0:o.lat)||0],[((n=a.pickup_coordinates)==null?void 0:n.lng)||0,((c=a.pickup_coordinates)==null?void 0:c.lat)||0],[((m=a.dropoff_coordinates)==null?void 0:m.lng)||0,((x=a.dropoff_coordinates)==null?void 0:x.lat)||0]),$(a),_([((t=a.current_coordinates)==null?void 0:t.lng)||0,((w=a.current_coordinates)==null?void 0:w.lat)||0]),L([((S=a.pickup_coordinates)==null?void 0:S.lng)||0,((E=a.pickup_coordinates)==null?void 0:E.lat)||0]),D([((R=a.dropoff_coordinates)==null?void 0:R.lng)||0,((T=a.dropoff_coordinates)==null?void 0:T.lat)||0]),p(!1)}catch(u){console.error("Error fetching trip:",u),p(!1)}},v=async(r,o,n="route")=>{try{const c=`${r[0]},${r[1]}`,m=`${o[0]},${o[1]}`,x=await fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${c};${m}?geometries=geojson&access_token=${U}`);if(!x.ok)throw new Error("Failed to fetch route");const t=await x.json();if(console.log("Route data:",t.routes),console.log("Route geometry data:",t.routes[0].geometry),console.log("Route distance:",t.routes[0].distance),console.log("Route duration:",t.routes[0].duration),t.routes&&t.routes.length>0)n==="route"?P({type:"Feature",properties:{distance:t.routes[0].distance,duration:t.routes[0].duration},geometry:t.routes[0].geometry}):n==="route2"&&z({type:"Feature",properties:{distance:t.routes[0].distance,duration:t.routes[0].duration},geometry:t.routes[0].geometry});else throw new Error("No route found")}catch(c){const m=c instanceof Error?c.message:"Unknown error";G(m),console.error("Error fetching route:",c)}finally{p(!1)}},A=async(r,o,n)=>{if(!(!r||!o||!n)){h(!0);try{await v([r[0],r[1]],[o[0],o[1]],"route"),await v([o[0],o[1]],[n[0],n[1]],"route2"),h(!1)}catch(c){I(c.message),h(!1),console.error("Error fetching routes:",c)}}},f=r=>(r/1609.34).toFixed(2),g=r=>{const o=Math.floor(r/3600),n=Math.floor(r%3600/60);return o===0?`${n}m`:`${o}h ${n}m`};return i.useEffect(()=>{F()},[j]),e.jsx("div",{className:"min-h-screen bg-gray-100 p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto bg-white rounded-xs shadow-md p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Trip Details"}),e.jsx(k,{to:"/trips",className:"text-sm text-[#043f51] hover:text-[#008080] flex items-center",children:"‚Üê Back to Trips"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-4",children:"Trip Information"}),e.jsxs("div",{className:"max-w-xl mx-auto px-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"mb-0",children:[e.jsxs("p",{className:"text-xs mb-2",children:[e.jsx("span",{className:"text-gray-700",children:"Starting Location: "}),e.jsx("span",{className:"font-bold",children:s==null?void 0:s.current_location})]}),e.jsxs("p",{className:"text-xs mb-2",children:[e.jsx("span",{className:"text-gray-700",children:"Pickup Location: "}),e.jsx("span",{className:"font-bold",children:s==null?void 0:s.pickup_location})]})]}),e.jsxs("div",{className:"mb-0",children:[e.jsxs("p",{className:"text-xs mb-2",children:[e.jsx("span",{className:"text-gray-700",children:"Dropoff Location: "}),e.jsx("span",{className:"font-bold",children:s==null?void 0:s.dropoff_location})]}),e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"text-gray-700",children:" Current Cycle Used: "}),e.jsx("span",{className:"font-bold",children:s==null?void 0:s.current_cycle_used})]})]})]}),s&&l&&d&&e.jsx("div",{className:"mx-auto px-4 text-xs mt-5 text-center",children:e.jsx(k,{to:`/trip/${s.id}/log-sheets`,className:"bg-transparent hover:bg-[#008080] text-[#008080] font-semibold hover:text-white py-2 px-4 border border-[#008080] hover:border-transparent rounded",children:"View Log Sheets"})})]})]},s==null?void 0:s.id),e.jsx("hr",{className:"mb-6 mt-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-4",children:"Route Map"}),e.jsx("div",{className:"max-w-3xl mx-auto px-0",children:l&&d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("p",{className:"text-xs mb-2",children:[e.jsx("span",{className:"text-gray-700",children:"Start to Pickup: "}),"(Distance: ",e.jsxs("span",{className:"font-bold",children:[f(l.properties.distance)," miles"]}),", Duration: ",e.jsx("span",{className:"font-bold",children:g(l.properties.duration)}),")"]}),e.jsxs("p",{className:"text-xs mb-2",children:[e.jsx("span",{className:"text-gray-700",children:"Pickup to Dropoff: "}),"(Distance: ",e.jsxs("span",{className:"font-bold",children:[f(d.properties.distance)," miles"]}),", Duration: ",e.jsx("span",{className:"font-bold",children:g(d.properties.duration)}),")"]})]}),e.jsx("div",{className:"mb-2",children:e.jsxs("p",{className:"text-xs mb-2",children:[e.jsx("span",{className:"text-gray-700",children:"Whole Trip: "}),"(Distance: ",e.jsxs("span",{className:"font-bold",children:[f(d.properties.distance+l.properties.distance)," miles"]}),", Duration: ",e.jsx("span",{className:"font-bold",children:g(d.properties.duration+l.properties.duration)}),")"]})})]})}),e.jsx("div",{className:"max-w-3xl mx-auto px-0",children:M||!N||!y||!b||!l||!d?e.jsx("p",{children:"Loading..."}):e.jsx(B,{startCoords:N,pickupCoords:y,endCoords:b,route:l,route2:d,zoom:9})})]})]})]})})});export{ee as default};
